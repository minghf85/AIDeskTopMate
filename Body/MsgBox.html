<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>桌宠消息弹窗</title>
    <style>
        /* 弹窗基础样式 */
        .pet-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background-color: #fff9e6;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .pet-popup.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* 弹窗头部 */
        .pet-header {
            background-color: #ffcc80;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        
        .pet-name {
            font-weight: bold;
            color: #5d4037;
            margin-left: 10px;
        }
        
        .pet-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* 弹窗内容 */
        .pet-content {
            padding: 15px;
            min-height: 80px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .pet-message {
            line-height: 1.5;
            color: #5d4037;
        }
        
        /* 表情包样式 */
        .pet-emoji {
            width: 24px;
            height: 24px;
            vertical-align: middle;
            margin: 0 2px;
        }
        
        /* 弹窗底部 */
        .pet-footer {
            display: flex;
            justify-content: flex-end;
            padding: 10px 15px;
            background-color: #fff3e0;
            border-top: 1px solid #ffe0b2;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
        }
        
        .pet-button {
            background-color: #ffb74d;
            border: none;
            padding: 5px 15px;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .pet-button:hover {
            background-color: #ffa726;
        }
        
        /* 动画效果 */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .pet-bounce {
            animation: bounce 0.5s infinite;
        }
        
        /* 打字效果 */
        .typing-cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background-color: #ff7043;
            vertical-align: middle;
            margin-left: 2px;
            animation: blink 0.7s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="pet-popup" id="petPopup">
        <div class="pet-header">
            <img src="https://placekitten.com/100/100" alt="桌宠头像" class="pet-avatar" id="petAvatar">
            <span class="pet-name" id="petName">小萌宠</span>
        </div>
        <div class="pet-content">
            <p class="pet-message" id="petMessage"></p>
        </div>
        <div class="pet-footer">
            <button class="pet-button" id="petCloseBtn">知道了</button>
        </div>
    </div>

    <script>
        // 音频资源
        const soundEffects = {
            appear: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3'),
            typing: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-computer-interface-option-select-2573.mp3'),
            close: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-quick-jump-arcade-game-239.mp3'),
            emoji: new Audio('https://assets.mixkit.co/sfx/preview/mixkit-cartoon-voice-laugh-360.mp3')
        };
        
        // 表情包资源
        const emojis = {
            happy: 'https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/325/grinning-face_1f600.png',
            love: 'https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/325/smiling-face-with-hearts_1f970.png',
            wow: 'https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/325/face-with-open-mouth_1f62e.png',
            cry: 'https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/325/loudly-crying-face_1f62d.png',
            angry: 'https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/120/apple/325/pouting-face_1f621.png'
        };
        
        // 初始化弹窗
        const petPopup = document.getElementById('petPopup');
        const petMessage = document.getElementById('petMessage');
        const petAvatar = document.getElementById('petAvatar');
        const petName = document.getElementById('petName');
        const petCloseBtn = document.getElementById('petCloseBtn');
        
        // 显示弹窗
        function showPopup(options = {}) {
            const {
                name = '小萌宠',
                avatar = 'https://placekitten.com/100/100',
                message = '你好呀！我是你的桌宠~',
                delay = 0,
                typingSpeed = 30,
                emoji = null,
                sound = true
            } = options;
            
            // 设置头像和名字
            petName.textContent = name;
            petAvatar.src = avatar;
            
            // 播放出现音效
            if (sound) {
                soundEffects.appear.play();
            }
            
            // 显示弹窗
            setTimeout(() => {
                petPopup.classList.add('show');
                
                // 流式输出文本
                typeMessage(message, typingSpeed, emoji, sound);
            }, delay);
        }
        
        // 流式输出文本
        function typeMessage(message, speed, emoji, sound) {
            petMessage.innerHTML = '';
            let i = 0;
            const typingCursor = document.createElement('span');
            typingCursor.className = 'typing-cursor';
            petMessage.appendChild(typingCursor);
            
            const typingInterval = setInterval(() => {
                if (i < message.length) {
                    // 播放打字音效
                    if (sound && i % 3 === 0) {
                        soundEffects.typing.currentTime = 0;
                        soundEffects.typing.play();
                    }
                    
                    petMessage.removeChild(typingCursor);
                    petMessage.innerHTML += message.charAt(i);
                    petMessage.appendChild(typingCursor);
                    i++;
                    
                    // 滚动到底部
                    petMessage.parentElement.scrollTop = petMessage.parentElement.scrollHeight;
                } else {
                    clearInterval(typingInterval);
                    petMessage.removeChild(typingCursor);
                    
                    // 添加表情包
                    if (emoji && emojis[emoji]) {
                        if (sound) {
                            soundEffects.emoji.play();
                        }
                        
                        const emojiImg = document.createElement('img');
                        emojiImg.src = emojis[emoji];
                        emojiImg.className = 'pet-emoji';
                        emojiImg.alt = emoji;
                        petMessage.appendChild(emojiImg);
                        
                        // 添加弹跳动画
                        setTimeout(() => {
                            emojiImg.classList.add('pet-bounce');
                        }, 100);
                    }
                }
            }, speed);
        }
        
        // 关闭弹窗
        petCloseBtn.addEventListener('click', () => {
            soundEffects.close.play();
            petPopup.classList.remove('show');
        });
        
        // 示例用法
        setTimeout(() => {
            showPopup({
                name: '快乐小喵',
                avatar: 'https://placekitten.com/150/150',
                message: '主人你好呀！今天过得怎么样？希望你有美好的一天~',
                typingSpeed: 50,
                emoji: 'happy',
                sound: true
            });
        }, 1000);
        
        // 可以调用showPopup函数来显示不同的消息
        // showPopup({
        //     name: '生气小汪',
        //     avatar: 'https://placedog.net/150/150',
        //     message: '你昨天忘记喂我了！我很生气！',
        //     typingSpeed: 30,
        //     emoji: 'angry',
        //     sound: true
        // });
    </script>
</body>
</html>